
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>MD User Guide - 98336/98633 Documents</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="98336/98633 Documents" class="md-header__button md-logo" aria-label="98336/98633 Documents" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            98336/98633 Documents
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MD User Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="98336/98633 Documents" class="md-nav__button md-logo" aria-label="98336/98633 Documents" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    98336/98633 Documents
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          CVAI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CVAI" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          CVAI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          MD User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="NT9833X_MD_User_Guide_en.html" class="md-nav__link md-nav__link--active">
        MD User Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-overview" class="md-nav__link">
    1.1 Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-motion-detection-steps" class="md-nav__link">
    1.2 Motion detection steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-process-flow" class="md-nav__link">
    1.3 Process Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-parameters" class="md-nav__link">
    1.4 Parameters
  </a>
  
    <nav class="md-nav" aria-label="1.4 Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-parameters-of-vendor-md" class="md-nav__link">
    1.4.1 Parameters of vendor MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-parameters-of-libmd" class="md-nav__link">
    1.4.2 Parameters of libmd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-initilization-of-md" class="md-nav__link">
    1.5 Initilization of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-parameters-setting-of-md" class="md-nav__link">
    1.6 Parameters Setting of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-execution-of-md" class="md-nav__link">
    1.7 Execution of MD
  </a>
  
    <nav class="md-nav" aria-label="1.7 Execution of MD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#171-vendor-md" class="md-nav__link">
    1.7.1 vendor MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#172-libmd" class="md-nav__link">
    1.7.2 libmd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-requirement-of-md" class="md-nav__link">
    1.8 Requirement of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-limitation-of-md" class="md-nav__link">
    1.9 Limitation of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#110-test-flow-of-md" class="md-nav__link">
    1.10 Test Flow of MD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-output" class="md-nav__link">
    2 Output
  </a>
  
    <nav class="md-nav" aria-label="2 Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-get-output-results-of-md" class="md-nav__link">
    2.1 Get Output Results of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-print-output-results-of-md" class="md-nav__link">
    2.2 Print Output Results of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-limitation-md-hardware" class="md-nav__link">
    2.3 Limitation MD Hardware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-requirement-of-md-system" class="md-nav__link">
    2.4 Requirement of MD System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-tuning-of-md-parameters" class="md-nav__link">
    2.5 Tuning of MD Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-qa" class="md-nav__link">
    3 Q&amp;A
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-revision-history" class="md-nav__link">
    4 Revision History
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="NT9833x_VPE_IQ_Tuning_Guide_en.html" class="md-nav__link">
        VPE IQ Tuning Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-overview" class="md-nav__link">
    1.1 Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-motion-detection-steps" class="md-nav__link">
    1.2 Motion detection steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-process-flow" class="md-nav__link">
    1.3 Process Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-parameters" class="md-nav__link">
    1.4 Parameters
  </a>
  
    <nav class="md-nav" aria-label="1.4 Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-parameters-of-vendor-md" class="md-nav__link">
    1.4.1 Parameters of vendor MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-parameters-of-libmd" class="md-nav__link">
    1.4.2 Parameters of libmd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-initilization-of-md" class="md-nav__link">
    1.5 Initilization of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-parameters-setting-of-md" class="md-nav__link">
    1.6 Parameters Setting of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-execution-of-md" class="md-nav__link">
    1.7 Execution of MD
  </a>
  
    <nav class="md-nav" aria-label="1.7 Execution of MD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#171-vendor-md" class="md-nav__link">
    1.7.1 vendor MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#172-libmd" class="md-nav__link">
    1.7.2 libmd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-requirement-of-md" class="md-nav__link">
    1.8 Requirement of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-limitation-of-md" class="md-nav__link">
    1.9 Limitation of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#110-test-flow-of-md" class="md-nav__link">
    1.10 Test Flow of MD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-output" class="md-nav__link">
    2 Output
  </a>
  
    <nav class="md-nav" aria-label="2 Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-get-output-results-of-md" class="md-nav__link">
    2.1 Get Output Results of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-print-output-results-of-md" class="md-nav__link">
    2.2 Print Output Results of MD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-limitation-md-hardware" class="md-nav__link">
    2.3 Limitation MD Hardware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-requirement-of-md-system" class="md-nav__link">
    2.4 Requirement of MD System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-tuning-of-md-parameters" class="md-nav__link">
    2.5 Tuning of MD Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-qa" class="md-nav__link">
    3 Q&amp;A
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-revision-history" class="md-nav__link">
    4 Revision History
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>MD User Guide</h1>

<p>NT9833X MD User  Guide</p>
<h2 id="1-introduction">1 Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<h3 id="11-overview">1.1 Overview<a class="headerlink" href="#11-overview" title="Permanent link">&para;</a></h3>
<p>The motion detection supports applications including global motion detection, sub-region motion detection, motion object detection and tamper detection.</p>
<p>l <strong>Global motion detection</strong></p>
<p>By using a fixed camera, global motion detection issues alarm if the area of moving objects is larger than the user-defined threshold.</p>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image002.gif" /></p>
<p>Figure 1? Global motion detection</p>
<p>l <strong>Sub-region motion detection</strong></p>
<p>By using a fixed camera, this function issues a sub-region  motion alarm if the area of moving objects in the user-defined regions is larger than the user-defined threshold.</p>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image003.gif" /> </p>
<p>Figure 2? Sub-region motion alarm</p>
<p>l <strong>Motion objects detection</strong></p>
<p>By using a fixed camera, it detects moving objects if their areas are larger than a user-defined threshold.? It also reports the sizes and coordinates of detected moving objects.</p>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image004.gif" /> </p>
<p>Figure 3? Motion objects detection</p>
<p>l <strong>Tamper detection</strong></p>
<p>By using a fixed camera, it issues a tamper alarm if the occlusion area is larger than a user-defined area threshold.</p>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image005.jpg" /></p>
<p>Figure 4: Tamper Detection</p>
<h3 id="12-motion-detection-steps">1.2 Motion detection steps<a class="headerlink" href="#12-motion-detection-steps" title="Permanent link">&para;</a></h3>
<p>The steps of motion  detection functions are</p>
<p>Step. 1: Generating a initial background model by using the first few frames.</p>
<p>Step. 2: Micro block (MB) map is used in motion detection. The size of each MB can be 32x32 or 16x16. The algorithm determines a MB as a motion block if the variance of blocks  is higher than a predefined threshold.</p>
<p>Step. 3: Updating the background model by using current frame information.</p>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image006.gif" /></p>
<p>Figure 5. The flowchart of MD algoritm</p>
<h3 id="13-process-flow">1.3 Process Flow<a class="headerlink" href="#13-process-flow" title="Permanent link">&para;</a></h3>
<p><img alt="" src="NT9833X_MD_User_Guide_en.files/image007.gif" /></p>
<p>Figure 6. The process flow of MD</p>
<h3 id="14-parameters">1.4 Parameters<a class="headerlink" href="#14-parameters" title="Permanent link">&para;</a></h3>
<p>MD has two major parameter types, as listed below</p>
<p>l The parameters of vendor MD are used to control MD hardware.</p>
<p>l The parameters of libmd are used to control MD software application.</p>
<p>l Please notice that the parameters of vendor MD should be set before setting the parameters of libmd.</p>
<h4 id="141-parameters-of-vendor-md">1.4.1 Parameters of vendor MD<a class="headerlink" href="#141-parameters-of-vendor-md" title="Permanent link">&para;</a></h4>
<p>l VENDOR_MD_CTRL: trigger setting of MD hardware</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
<td>Value</td>
</tr>
<tr>
<td>engine_enabled</td>
<td>0, 1</td>
<td>HW trigger setting</td>
<td>0: close<br><br>1: open</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_MDT_INFO: size information of MD hardware</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
<td>Value</td>
</tr>
<tr>
<td>phy_width</td>
<td>32~3840</td>
<td>Sensor resolution (width)</td>
<td>&ndash;</td>
</tr>
<tr>
<td>phy_height</td>
<td>16~2160</td>
<td>Sensor resolution (height)</td>
<td>&ndash;</td>
</tr>
<tr>
<td>phy_mb_x_size</td>
<td>16, 32</td>
<td>The x-size of micro-block (MB) for HW</td>
<td>Set 32 when the phy_height is bigger than 1088.<br><br>Set 16 when the phy_height is smaller than or equal to 1088.</td>
</tr>
<tr>
<td>phy_mb_y_size</td>
<td>16, 32</td>
<td>The y-size of MB for HW</td>
<td>Same value of phy_mb_x_size.</td>
</tr>
<tr>
<td>phy_mb_x_num</td>
<td></td>
<td>The number of MB in the MB-map at x-direction</td>
<td>phy_width/ phy_mb_x_size</td>
</tr>
<tr>
<td>phy_mb_y_num</td>
<td></td>
<td>The number of MB in the MB-map at y-direction</td>
<td>phy_height/ phy_mb_y_size</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_MDT_PARAM_IDX: index of MD background model parameters</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>Comment</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_RST</td>
<td>Background model reset</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TYPE</td>
<td>The method to construct background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TIME_PERIOD</td>
<td>update time of background model<br><br>(only for MD2)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TBG</td>
<td>Weight threshold of background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_ALPHA</td>
<td>Learning rate for the fitting background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_ONE_MIN_ALPHA</td>
<td>Learning rate for the nun-fitting background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_INIT_WEIGHT</td>
<td>Initial weight of background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_MODEL_UPDATE</td>
<td>Update constraint of background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TB</td>
<td>Threshold of foreground detection</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_SIGMA</td>
<td>Variance threshold of background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TG</td>
<td>Threshold of background model update</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_PRUNE</td>
<td>Threshold to decrease weight for nun-fitting background model</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_LUMA_DIFF_THRES</td>
<td>Luminance variance threshold at refine stage (only for MD1)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_DIFF_THRES</td>
<td>Texture variance threshold at refine stage<br><br>(only for MD1)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_THRES</td>
<td>Texture strength threshold at refine stage<br><br>(only for MD1)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_RATIO_THRES</td>
<td>Texture coverage ratio threshold at refine stage (only for MD1)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_GM_MD2_THRES</td>
<td>Background threshold<br><br>(only for MD2)</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_MDT_PARAM: parameters of MD background model</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>out_id</td>
<td>Path id</td>
</tr>
<tr>
<td>level</td>
<td>Choose the selective model</td>
</tr>
<tr>
<td>id</td>
<td>VENDOR_MD_MDT_PARAM_IDX</td>
</tr>
<tr>
<td>value</td>
<td>Parameter value</td>
</tr>
</tbody>
</table>
<p>l Value range of the VENDOR_MD_MDT_PARAM</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>VENDOR_MD_MDT_PARAM_IDX</td>
<td>Range</td>
<td>Comment</td>
<td>Value</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_RST</td>
<td>0, 1</td>
<td>Reset MD background model</td>
<td>0: no reset<br><br>1: reset</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TYPE</td>
<td>0, 1</td>
<td>MD method type</td>
<td>0: MD1 (HW)<br><br>(learning-based)<br><br>1: MD2 (HW) difference-based)</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TIME_PERIOD</td>
<td>-</td>
<td>Background update frame threshold<br><br>(only for MD2)</td>
<td>10</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_TBG</td>
<td>1~32767</td>
<td>Background model weight threshold<br><br><strong>Suggest not to modify the value.</strong></td>
<td>29490</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_ALPHA</td>
<td>1~32767</td>
<td>Background learning rate threshold when input fits model. Please set higher value when AE change obviously to avoid false alarm.</td>
<td>32</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_ONE_MIN_ALPHA</td>
<td>1~32767</td>
<td>Background learning rate threshold when input doesn’t fit model.</td>
<td>32736</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_INIT_WEIGHT</td>
<td>1~32767</td>
<td>Background model initial weight</td>
<td>32</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_MODEL_UPDATE</td>
<td>0, 1</td>
<td>Background model constraint update<br><br><strong>Suggest not to modify the value.</strong></td>
<td>0</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TB</td>
<td>1~31</td>
<td>Background model fitting threshold. The MD is more sensitive when the value is lower.</td>
<td>25</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_SIGMA</td>
<td>1~31</td>
<td>Background model variance threshold. Set larger value to avoid false alarm when background luminance changes large. Please set the value lower when the MD result of detected object is broken.</td>
<td>25</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TG</td>
<td>1~31</td>
<td>Background model count threshold.<br><br><strong>Suggest not to modify the value.</strong></td>
<td>9</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_PRUNE</td>
<td>1~32767</td>
<td>Weight decrease threshold for un-fitting model</td>
<td>51</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_LUMA_DIFF_THRES</td>
<td>0~255</td>
<td>Luminance variance threshold at refine stage (only for MD1)</td>
<td>0</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_DIFF_THRES</td>
<td>0~255</td>
<td>Texture variance threshold at refine stage (only for MD1)</td>
<td>0</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_THRES</td>
<td>0~255</td>
<td>Texture strength threshold at refine stage (only for MD1)</td>
<td>0</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_TEXT_RATIO_THRES</td>
<td>0~127</td>
<td>Texture coverage ratio threshold at refine stage (only for MD1)</td>
<td>127</td>
</tr>
<tr>
<td>VENDOR_MD_MDT_PARAM_LVL_GM_MD2_THRES</td>
<td>0~255</td>
<td>Background threshold (only for MD2)</td>
<td>10</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_MDT_MB_LEVEL: region setting of the background model</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>x</td>
<td>0~max_width</td>
<td>x position of the left upper corner of the region (physical plane, Unit: pixel)</td>
</tr>
<tr>
<td>y</td>
<td>0~max_height</td>
<td>y position of the left upper corner of the region (physical plane, Unit: pixel)</td>
</tr>
<tr>
<td>width</td>
<td>1~max_width</td>
<td>width of the left upper corner of the region (physical plane, Unit: pixel)</td>
</tr>
<tr>
<td>height</td>
<td>1~max_height</td>
<td>height of the left upper corner of the region (physical plane, Unit: pixel)</td>
</tr>
<tr>
<td>level</td>
<td>0~3</td>
<td>The selective background model of the region</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_TDT_PARAM_IDX: index of the tamper detection parameters</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>Comment</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_TYPE</td>
<td>Tamper detection method type</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_EDGE_TEX_THRES</td>
<td>Texture strength threshold</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_EDGE_WIN_THRES</td>
<td>Coverage of low texture strength threshold</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_AVG_TEX_THRES</td>
<td>Luminance strength threshold</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_AVG_WIN_THRES</td>
<td>Coverage of low luminance strength threshold</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_MDT_PARAM: tamper detection parameters</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>out_id</td>
<td>Path id</td>
</tr>
<tr>
<td>id</td>
<td>VENDOR_MD_TDT_PARAM_IDX</td>
</tr>
<tr>
<td>value</td>
<td>Parameter value</td>
</tr>
</tbody>
</table>
<p>l Value range of the tamper detection parameters</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>VENDOR_MD_TDT_PARAM_IDX</td>
<td>Range</td>
<td>Comment</td>
<td>Default</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_TYPE</td>
<td>0, 1</td>
<td>Tamper detection method</td>
<td>0: edge-based<br><br>1: intensity based</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_EDGE_TEX_THRES</td>
<td>0~255</td>
<td>Texture strength threshold</td>
<td>25</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_EDGE_WIN_THRES</td>
<td>0~127</td>
<td>Coverage of low texture strength threshold</td>
<td>100</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_AVG_TEX_THRES</td>
<td>0~255</td>
<td>Luminance strength threshold</td>
<td>65</td>
</tr>
<tr>
<td>VENDOR_MD_TDT_PARAM_AVG_WIN_THRES</td>
<td>0~127</td>
<td>Coverage of low luminance strength threshold</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>l VENDOR_BUFFER : buffer information structure</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>paddr</td>
<td>Physical address</td>
</tr>
<tr>
<td>size</td>
<td>Buffer size</td>
</tr>
<tr>
<td>ddr_id</td>
<td>DDR_IDX</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_BUFFER: buffer information of MD hardware</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>mb_x_num_max</td>
<td>Maximum width of the MB number(Unit: MB number)</td>
</tr>
<tr>
<td>mb_y_num_max</td>
<td>Maximum height of the MB number(Unit: MB number)</td>
</tr>
<tr>
<td>sta</td>
<td>MD HW statistics value buffer</td>
</tr>
<tr>
<td>event</td>
<td>MD HWmotion bitmap buffer</td>
</tr>
<tr>
<td>level</td>
<td>MD HW selective background model buffer</td>
</tr>
</tbody>
</table>
<p>l VENDOR_MD_PARAM_ID: index of vendor_md function</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>Comment</td>
</tr>
<tr>
<td>VENDOR_MD_CTRL_PARAM</td>
<td>MD HW control structure</td>
</tr>
<tr>
<td>VENDOR_MD_MOTION_DETECT_INFO</td>
<td>MD HW process size unit structure</td>
</tr>
<tr>
<td>VENDOR_MD_MOTION_DETECT_PARAM</td>
<td>MD HW background model parameter structure</td>
</tr>
<tr>
<td>VENDOR_MD_MOTION_DETECT_MB_LEVEL</td>
<td>MD HW background model selective model structure</td>
</tr>
<tr>
<td>VENDOR_MD_MOTION_DETECT_BUFFER</td>
<td>MD HW buffer structure</td>
</tr>
<tr>
<td>VENDOR_MD_TAMPER_DETECT_PARAM</td>
<td>MD HW tamper parameter structure</td>
</tr>
<tr>
<td>VENDOR_MD_RESULT_INFO</td>
<td>MD HW result structure</td>
</tr>
<tr>
<td>VENDOR_MD_REASSIGN_BUFFERS</td>
<td>MD reassign buffer API. When max MB num is larger than (1920/16, 1080/16) or want to shrink MD buffer size. Note: hdal default pool buffer size for MD is (120,67) and 8 channel. If you use reassign buffer, you should change the hdal default pool buffer size.</td>
</tr>
</tbody>
</table>
<h4 id="142-parameters-of-libmd">1.4.2 Parameters of libmd<a class="headerlink" href="#142-parameters-of-libmd" title="Permanent link">&para;</a></h4>
<p>l LIB_MD_AP_ENABLE: trigger setting of MD application:?</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>globel_md_alarm_detect_en</td>
<td>0, 1</td>
<td>Global motion alarm enable</td>
</tr>
<tr>
<td>subregion_md_alarm_detect_en</td>
<td>0, 1</td>
<td>Sub-region motion alarm enable</td>
</tr>
<tr>
<td>md_obj_detect_en</td>
<td>0, 1</td>
<td>Objects detection enable</td>
</tr>
<tr>
<td>md_postprocess_en</td>
<td>0, 1</td>
<td>Motionbitmap postprocess enable</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_EVT_INFO: results of motion detection</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>p_evt_map</td>
<td>MD HW event bimap buffer</td>
</tr>
<tr>
<td>evt_sz</td>
<td>MD HW event bimap buffer size</td>
</tr>
<tr>
<td>timestamp</td>
<td>MD event timestamp</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_MDT_INFO: size setting information of libmd</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
<td>Default</td>
</tr>
<tr>
<td>md_enabled</td>
<td>0, 1</td>
<td>Libmd enable</td>
<td>vendor_md engine_enabled should be enable firstly</td>
</tr>
<tr>
<td>vp_width</td>
<td>1~3840</td>
<td>User plane width</td>
<td>suggest to set as sensor setting</td>
</tr>
<tr>
<td>vp_height</td>
<td>1~2160</td>
<td>User plane height</td>
<td>suggest to set as sensor setting</td>
</tr>
<tr>
<td>vp_mb_x_size</td>
<td>16, 32</td>
<td>Width of MB size in the user plane</td>
<td>suggest to set the same value of phy_mb_x_size</td>
</tr>
<tr>
<td>vp_mb_y_size</td>
<td>16, 32</td>
<td>Height of MB size in the user plane</td>
<td>suggest to set the same value of phy_mb_y_size</td>
</tr>
<tr>
<td>vp_mb_x_num</td>
<td>-</td>
<td>Width of MB number in the user plane</td>
<td>vp_width / vp_mb_x_size</td>
</tr>
<tr>
<td>vp_mb_y_num</td>
<td>-</td>
<td>Height of MB number in the user plane</td>
<td>vp_height / vp_mb_y_size</td>
</tr>
<tr>
<td>phy_mb_x_size</td>
<td>16, 32</td>
<td>HW width of MB size</td>
<td>set the same as vendor_md</td>
</tr>
<tr>
<td>phy_mb_y_size</td>
<td>16, 32</td>
<td>HW height of MB size</td>
<td>set the same as vendor_md</td>
</tr>
<tr>
<td>phy_mb_x_num</td>
<td></td>
<td>Sensor_width/ phy_mb_x_size</td>
<td>set the same as vendor_md</td>
</tr>
<tr>
<td>phy_mb_y_num</td>
<td></td>
<td>Sensor_height/ phy_mb_y_size</td>
<td>set the same as vendor_md</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_POSTPROCESS: post-process type of libmd event</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
<td>Default</td>
</tr>
<tr>
<td>evt_postprocess_type</td>
<td>0~7</td>
<td>Motion event postprocess</td>
<td>0: no<br><br>1: one erosion + two dilation<br><br>2: two dilation + one erosion<br><br>3: two dilation<br><br>4: one dilation<br><br>5: one erosion<br><br>6: one dilation + one erosion<br><br>7: one erosion + one dilation</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_GLOBAL_MOTION_ALARM: parameters of global motion alarm detection</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>motion_alarm_th</td>
<td>0~100</td>
<td>Global motion detection alarm area coverage ratio threshold (%).<br><br>MD is more sensitive when the value is lower.</td>
</tr>
<tr>
<td>ref_cell_en</td>
<td>0, 1</td>
<td>The detection result will reference p_cell_map or not. When the value is 1, the global motion alarm/ sub-region motion alarm/ object detection result will reference the p_cell_map.</td>
</tr>
<tr>
<td>p_cell_map</td>
<td>0, 1</td>
<td>The detection result will reference the buffer when the ref_cell_en=1.</td>
</tr>
<tr>
<td>cell_map_sz</td>
<td>vp_mb_x_num* vp_mb_y_num</td>
<td>The buffer size of the p_cell_map</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_SUBREGION: parameters of specified sub-region structure</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>enabled</td>
<td>0, 1</td>
<td>Sub-region motion detection alarm enable</td>
</tr>
<tr>
<td>x_start</td>
<td>0~mb_w_num-1</td>
<td>x position of the left upper corner of the region (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>y_start</td>
<td>0~mb_h_num-1</td>
<td>y position of the left upper corner of the region (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>x_end</td>
<td>0~mb_w_num-1</td>
<td>x position of the right under corner of the region (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>y_end</td>
<td>0~mb_h_num-1</td>
<td>y position of the right under corner of the region (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>alarm_th</td>
<td>0~100</td>
<td>Sub-region motion detection alarm area coverage ratio threshold (%).<br><br>MD is more sensitive when the value is lower.</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_SUBREGION_MOTION_ALARM: parameters of sub-region motion alarm detection</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>sub_region_num</td>
<td>0~4</td>
<td>Specified sub-region number</td>
</tr>
<tr>
<td>sub_region</td>
<td>-</td>
<td>Specified sub-region structure</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_OBJ: size setting of minmum motion object</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>object_size</td>
<td>-</td>
<td>Minimum size of detected moing objects (Unit: macro block)</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_AP_OBJ_INFO: information of motion objects</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
</tr>
<tr>
<td>start_x</td>
<td>0~ vp_width</td>
<td>x position of the left upper corner of the motion object (virtual plane，Unit:pixel)</td>
</tr>
<tr>
<td>start_y</td>
<td>0~vp_height</td>
<td>y position of the left upper corner of the motion object (virtual plane，Unit:pixel)</td>
</tr>
<tr>
<td>end_x</td>
<td>0~ vp_width</td>
<td>x position of the right under corner of the motion object (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>end_y</td>
<td>0~vp_height</td>
<td>y position of the right under corner of the motion object (virtual plane，Unit: macro block)</td>
</tr>
<tr>
<td>label</td>
<td>0~128</td>
<td>Motion obect index</td>
</tr>
</tbody>
</table>
<p>l LIB_MD_MDT_RESULT_INFO: results information of the libmd</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Range</td>
<td>Comment</td>
<td>Value</td>
</tr>
<tr>
<td>global_motion_alarm</td>
<td>0, 1</td>
<td>Global motion detection alarm</td>
<td>0: no alarm<br><br>1: alarm</td>
</tr>
<tr>
<td>global_motion_alarm_num</td>
<td>0~ vp_mb_x_num* vp_mb_y_num</td>
<td>Motion MB number</td>
<td></td>
</tr>
<tr>
<td>sub_motion_alarm</td>
<td>0, 1</td>
<td>Sub-region motion detection alarm</td>
<td>0: no alarm<br><br>1: alarm</td>
</tr>
<tr>
<td>obj_num</td>
<td>0~128</td>
<td>Motion object number</td>
<td></td>
</tr>
<tr>
<td>obj</td>
<td>-</td>
<td>Motion object structure</td>
<td></td>
</tr>
<tr>
<td>vp_evt_info</td>
<td>-</td>
<td>Motion detection event map in the user plane</td>
<td></td>
</tr>
</tbody>
</table>
<p>l LIB_MD_PARAM_ID: index of libmd function</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameter</td>
<td>Comment</td>
</tr>
<tr>
<td>LIB_MD_MOTION_DETECT_INFO</td>
<td>Libmd set virtual/physical plane evt bitmap addr. Physical plane should be set the same as vendor_md. Physical evt bitmap address is vendor_md output result motion bitmap address.</td>
</tr>
<tr>
<td>evt bitmap addr為vendor_md output result</td>
<td>Libmd all detection application enable port</td>
</tr>
<tr>
<td>LIB_MD_AP_ENABLE_PARAM</td>
<td>Libmd postprocess enable</td>
</tr>
<tr>
<td>LIB_MD_AP_POSTPROCESS_PARAM</td>
<td>Libmd global motion detection enable</td>
</tr>
<tr>
<td>LIB_MD_AP_GLOBAL_MOTION_ALARM_PARAM</td>
<td>Libmd sub-region motion detection enable</td>
</tr>
<tr>
<td>LIB_MD_AP_SUBREGION_MOTION_ALARM_PARAM</td>
<td>Libmd motion object detection enable</td>
</tr>
<tr>
<td>LIB_MD_AP_OBJ_PARAM</td>
<td>Libmd result information</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> The MD model can lean the stable change of scene, such as river or twinkle light. If the user want to detect this kind of events, the parameters can be set as following:</p>
<p>l Model parameters</p>
<p>o tg=3</p>
<p>o tb=19</p>
<p>o alpha = 1024</p>
<p>l Refine process</p>
<p>o lum_diff_th=75</p>
<p>o tex_diff_th=50</p>
<p>o tex_ratio_th=50</p>
<h3 id="15-initilization-of-md">1.5 Initilization of MD<a class="headerlink" href="#15-initilization-of-md" title="Permanent link">&para;</a></h3>
<p>l Vendor MD</p>
<p>The buffer of vender MD and HW internal parametesrs should be set by the API as following:</p>
<p><strong><em>HD_RESULT md_init(void)</em></strong><strong><em>;</em></strong></p>
<p>l Libmd</p>
<p>The buffer of libmd and software parametesrs should be set by the API as following:</p>
<p><strong><em>HD_RESULT</em></strong> <strong><em>motion_set_ap_param(UINT32 path_id)</em></strong><strong><em>;</em></strong></p>
<p><strong><em>HD_RESULT</em></strong> <strong><em>lib_md_init(HD_PATH_ID path_id);</em></strong> // libmd buffer setting shoule be set after HW MD size setting which set through motion_set_ap_param.</p>
<h3 id="16-parameters-setting-of-md">1.6 Parameters Setting of MD<a class="headerlink" href="#16-parameters-setting-of-md" title="Permanent link">&para;</a></h3>
<p>l Vendor MD</p>
<p>Vendor MD parameters should be set by the following API.</p>
<p><strong><em>ret = vendor_md_set(video_cap[ch], VENDOR_MD_CTRL_PARAM, &amp;md_cfg);</em></strong></p>
<p>The content of <strong>VENDOR_MD_PARAM_ID</strong> is list in the section1.4.1.</p>
<p>l Libmd</p>
<p>The parameters of libmd should be set by the following API.</p>
<p><strong><em>ret = lib_md_set(path_id, LIB_MD_AP_ENABLE_PARAM, &amp;mdt_lib_param[idx].mdt_enable);</em></strong></p>
<p>The content of <strong>LIB_MD_PARAM_ID</strong> is list in the section1.4.2.</p>
<h3 id="17-execution-of-md">1.7 Execution of MD<a class="headerlink" href="#17-execution-of-md" title="Permanent link">&para;</a></h3>
<h4 id="171-vendor-md">1.7.1 vendor MD<a class="headerlink" href="#171-vendor-md" title="Permanent link">&para;</a></h4>
<p>Vendor MD application should be set by the following API.</p>
<p>// buffer and parameters intial setting</p>
<p>HD_RESULT md_init(void);</p>
<p>// create md_thread</p>
<p>static void *md_thread(void *arg);</p>
<p>//set and get vendor md API</p>
<p>ret = vendor_md_get(path_id, VENDOR_MD_MOTION_DETECT_INFO, &amp;mdt_info);</p>
<p>ret = vendor_md_set(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info);</p>
<p>ret = vendor_md_get(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info);</p>
<h4 id="172-libmd">1.7.2 libmd<a class="headerlink" href="#172-libmd" title="Permanent link">&para;</a></h4>
<p>libmd application should be set by the following API.</p>
<p>// buffer and parameters intial setting</p>
<p>HD_RESULT motion_set_ap_param(UINT32 path_id);</p>
<p>HD_RESULT lib_md_init(HD_PATH_ID path_id);</p>
<p>// create md_thread</p>
<p>static void *md_thread(void *arg);</p>
<p>//set and get libmd API</p>
<p>ret = vendor_md_get(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info); <strong>//libmd process should use vendor_md result as input</strong></p>
<p>vendor_md_get(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info)</p>
<p>ret = lib_md_set(path_id, LIB_MD_MOTION_DETECT_INFO, &amp;lib_md_info);</p>
<p>ret = lib_md_get(path_id, LIB_MD_RESULT_INFO, &amp;lib_md_rst);</p>
<h3 id="18-requirement-of-md">1.8 Requirement of MD<a class="headerlink" href="#18-requirement-of-md" title="Permanent link">&para;</a></h3>
<p>l MD funtions only be applied by CPU and HW.</p>
<h3 id="19-limitation-of-md">1.9 Limitation of MD<a class="headerlink" href="#19-limitation-of-md" title="Permanent link">&para;</a></h3>
<p>l MD shoud be used in the fixed-camera. If camera has been moved, MD function might output a false alarm event.</p>
<p>l MD function might output a false alarm event because of the zoom in/out of camera or the adjustment of auto white balance.</p>
<p>l The size of moving object should be larger than 1 micro-block (MB)</p>
<h3 id="110-test-flow-of-md">1.10 Test Flow of MD<a class="headerlink" href="#110-test-flow-of-md" title="Permanent link">&para;</a></h3>
<p>l Check MD use in the fixed-camera scene</p>
<p>l Check MD event bitmap to check MD flow</p>
<p>l MD should be used after 3 frames to create initial background.  </p>
<h2 id="2-output">2 Output<a class="headerlink" href="#2-output" title="Permanent link">&para;</a></h2>
<h3 id="21-get-output-results-of-md">2.1 Get Output Results of MD<a class="headerlink" href="#21-get-output-results-of-md" title="Permanent link">&para;</a></h3>
<p>l vendor MD</p>
<p>Vendor MD result should be set/got by the following API.</p>
<p>ret = vendor_md_set(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info);</p>
<p>ret = vendor_md_get(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info);</p>
<p>The structure of MD hardware result lists as following.</p>
<p>typedef struct _VENDOR_MD_MDT_RESULT_INFO {</p>
<p>UINT8???? ? *p_evt_map; ///&lt; motion detection bitmap, size is evt_sz</p>
<p>UINT32????? evt_sz; ///&lt; phy_mb_x_num*phy_mb_y_num MB</p>
<p>UINT8?????? tp_result; ///&lt; tamper alarm</p>
<p>???? UINT32??? ? timestamp;</p>
<p>} VENDOR_MD_MDT_RESULT_INFO;</p>
<p>l libmd</p>
<p>libmd result should be set/got by the following API.</p>
<p>vendor_md_get(path_id, VENDOR_MD_RESULT_INFO, &amp;result_info)</p>
<p>ret = lib_md_set(path_id, LIB_MD_MOTION_DETECT_INFO, &amp;lib_md_info);</p>
<p>ret = lib_md_get(path_id, LIB_MD_RESULT_INFO, &amp;lib_md_rst);</p>
<p>libmd result structure lists as following.</p>
<p>typedef struct _LIB_MD_MDT_RESULT_INFO {</p>
<p>UINT8???????? global_motion_alarm; ///&lt; global motion alarm</p>
<p>???? UINT32??? ??? global_motion_alarm_num;?????? ???? ?????????///&lt; global motion alarm num</p>
<p>UINT32??????? sub_motion_alarm[LIB_MD_MAX_SUB_REGION_NUM]; ///&lt; sub-region motion alarm</p>
<p>UINT32??????? obj_num; ///&lt; detect object number (max=128)</p>
<p>???? LIB_MD_AP_OBJ_INFO? obj[LIB_MD_MAX_OBJ_NUM];?????????? ????///&lt; detect object info</p>
<p>???? LIB_MD_EVT_INFO vp_evt_info;</p>
<p>} LIB_MD_MDT_RESULT_INFO;</p>
<p>typedef struct _LIB_MD_EVT_INFO {</p>
<p>UINT8???? ?? *p_evt_map; ///&lt; motion detection bitmap, size is evt_sz</p>
<p>UINT32?????? evt_sz; ///&lt; mb_x_num*mb_y_num MB</p>
<p>???? UINT32??? ?? timestamp;</p>
<p>} LIB_MD_EVT_INFO;</p>
<p>typedef struct _LIB_MD_AP_OBJ_INFO {</p>
<p>UINT32??????? start_x; ///&lt; obj rectangle left upper x position (virtual pixel)?</p>
<p>UINT32??????? start_y; ///&lt; obj rectangle left upper y position (virtual pixel)?</p>
<p>UINT32??????? end_x; ///&lt; obj rectangle right down x position (virtual pixel)?</p>
<p>UINT32??????? end_y; ///&lt; obj rectangle right down y position (virtual pixel)?</p>
<p>UINT32??????? label; ///&lt; obj label</p>
<p>} LIB_MD_AP_OBJ_INFO;</p>
<h3 id="22-print-output-results-of-md">2.2 Print Output Results of MD<a class="headerlink" href="#22-print-output-results-of-md" title="Permanent link">&para;</a></h3>
<p>l Output Result of Global Motion Detection</p>
<p>UART will print the results as following when motion area in the whole scene is larger than user-defined threshold.</p>
<p><strong><em>></em></strong> <strong><em>global motion alarm on ch</em></strong><strong><em>(specified channel)</em></strong><strong>.</strong></p>
<p>l Output Result of Sub-region Motion Detection</p>
<p>UART will print the results as following when the motion area in one or more sub-regions is larger than user-defined threshold.</p>
<p><strong><em>></em></strong> <strong><em>sub_region[</em></strong><strong><em>specified region index</em></strong><strong><em>] motion alarm on ch(</em></strong><strong><em>specified channel</em></strong><strong><em>)</em></strong><strong><em>.</em></strong></p>
<p>l Output Result of Motion Object Detection</p>
<p>UART will print the results as following when motion objects area are larger than minimum object user-defined threshold.</p>
<p><strong><em>> obj num:Motion object number</em></strong> <strong>and <em>obj[object index]: start_xy=[left upper corner position of motion object], end_xy = [right under corner position of motion object], label = object label.</em></strong></p>
<p>l Output Result of Tamper Detection</p>
<p>UART will print the results as following when occlusion area is larger than user-defined threshold.</p>
<p><strong><em>></em></strong> <strong><em>tamper_result:</em></strong><strong><em>1</em></strong> <strong><em>on ch</em></strong><strong><em>(specified channel)</em></strong><strong><em>.</em></strong></p>
<h3 id="23-limitation-md-hardware">2.3 Limitation MD Hardware<a class="headerlink" href="#23-limitation-md-hardware" title="Permanent link">&para;</a></h3>
<p>l Maximum sensor resolution is 3840x2160.</p>
<p>l Maximum MB number of MD hardware are (mb_x_num, mb_y_num) = (256, 128) and minimum MB number of MD hardware are (mb_x_num, mb_y_num) = (2, 1).</p>
<p>l In the Vcap flow, MD doesn’t support the scale function.</p>
<h3 id="24-requirement-of-md-system">2.4 Requirement of MD System<a class="headerlink" href="#24-requirement-of-md-system" title="Permanent link">&para;</a></h3>
<p>l The efficiency of MD function is associated with system loading. The ouput result of MD may be delayed when system is overloading.</p>
<h3 id="25-tuning-of-md-parameters">2.5 Tuning of MD Parameters<a class="headerlink" href="#25-tuning-of-md-parameters" title="Permanent link">&para;</a></h3>
<p>l In the scene with the shortly changing of light, such as AE adjustment or turn-on and turn-off the light, please set the value of  <em>alpha</em> higher. The side effect is that moving slowly object might be detected as background.</p>
<p>l Please set <strong><em>tb</em></strong>  to be higher for shadow. The side effect is that the detected forground of moving obeject might be broken. In this case, please also set “sigma” to be lower to fix the broken forground issue.</p>
<p>l The distance between moving object and camera should be farer than 30 cm. If the moving objects is too close to the camera, there might cause the false alarm of shadow.</p>
<p>l Please set lower <strong><em>tb</em></strong> when foreground luminance is similar background. However, the side effect is that the false alarm of shadow may be increase.</p>
<p>l Please see section 1.5 when you need to detect stable motion case.</p>
<p>l The MD function doesn’t support night view with IR-cut. In this case, there might be similar between background and foreground.</p>
<p>l There is no motion event when MD is creating intial background model. Also, MD will need longer time to create initial backgroung model if there are some moving objects in the initial scene.</p>
<p>l The size of moving object should be larger than 1 MB.</p>
<h2 id="3-qa">3 Q&amp;A<a class="headerlink" href="#3-qa" title="Permanent link">&para;</a></h2>
<p>(1) How to check vendor MD version?</p>
<p>Ans:</p>
<p>echo md &gt; /proc/hdal/flow</p>
<p>Execute AP</p>
<p>cat /proc/hdal/flow</p>
<p>(2) How to set the md sensitive?</p>
<p>Ans:</p>
<p>I. Use vendor_md_set API (the details describe in the 1.6 section and the section 1.4.1.</p>
<p>II. Tuning Guide document provide the tuning parameter suggestion. If any more question, please provide the video and parameters.</p>
<p>(3) How to solve sensor resolution change error?</p>
<p>Ans:</p>
<p>If you want to chage sensor reolution, please vendor_md_unint &amp; vendor_md_int at fisrt and you might see liveview_with_md_ctrl.c or liveview_with_md_resolution.c</p>
<p>(4) How to check sensor interlace case?</p>
<p>Ans:</p>
<p>MD is field input. If input is interlace, please set the half of the sensor input height. You can see interlace case through command as following cat /proc/vcap316/vcap0/vg_info.</p>
<p>(5) Check AD mode (960H and 720) case</p>
<p>Ans:</p>
<p>I. Check AD output is full frame.</p>
<p>II. MD input size is the same as the AD output size. phy_width andphy_height should be calculate by AD output (might not be the size of sensor). The size setting check by /proc/vcap316/vcap0/vg_info?and vcap md (detal describe in question 6 ).</p>
<p>(6) If any setting question of the vendor_md flow, please provide the log of vendor_md flow by the following command.</p>
<p>Ans:</p>
<p>echo md &gt; /proc/hdal/flow</p>
<p>Execute AP</p>
<p>cat /proc/hdal/flow</p>
<p>(7) How to check vcap md setting</p>
<p>Ans:</p>
<p>echo vcap_ch &gt; /proc/vcap316/vcap0/vcap0.CHIP/md/event</p>
<p>(vcap_ch and CHIP according to vg_info)</p>
<p>cat /proc/vcap316/vcap0/vcap0. CHIP /md/region</p>
<p>cat /proc/vcap316/vcap0/vcap0. CHIP /md/param</p>
<p>(8) How to solve the mb num &gt;(120,67)?</p>
<p>Ans:</p>
<p>I. modify hdal excel buffer size setting</p>
<p>II. open reassign_buffer</p>
<p>(9) How to use the level setting ?</p>
<p>Ans:</p>
<p>Each MB can be setted different level. Each level is mapping the set of background model. In nomal scene, all scene use the same level. In the scene which include both indoor and outdoor, you can set two level of the scene.</p>
<p>(10) Where is the tamper sample code?</p>
<p>Ans:</p>
<p>tamper sample code is liveview_with_md.c.</p>
<h2 id="4-revision-history">4 Revision History<a class="headerlink" href="#4-revision-history" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Revision</td>
<td>Date</td>
<td>Author</td>
<td>Changes</td>
</tr>
<tr>
<td>0.1</td>
<td>2021/06/30</td>
<td>Sophia</td>
<td>First formal version</td>
</tr>
<tr>
<td>0.2</td>
<td>2021/07/02</td>
<td>Sophia</td>
<td>Update document format and description</td>
</tr>
<tr>
<td>0.3</td>
<td>2022/06/24</td>
<td>Hunter</td>
<td>Modify the description of mb size and some wrong information.</td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
      
        
        <a href="NT9833x_VPE_IQ_Tuning_Guide_en.html" class="md-footer__link md-footer__link--next" aria-label="Next: VPE IQ Tuning Guide" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              VPE IQ Tuning Guide
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["search.highlight"], "search": "assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>